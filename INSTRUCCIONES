1.- Vamos a comenzar a crear nuestro primer servidor en el que albergaremos la api REST.
Para ello, ejecutamos npm install --save express para instalar express

2.- Introducimos este código en index.js (el archivo tiene que estar vacio)
//Importamos express
import express from 'express'

//Guardamos la instancia
let _server

//Generamos el objeto server con los metodos start y close
const server = {
  start () {
    //Creamos el servidor en express
    const app = express()

    //Guardamos la instancia y le decimos que escuche el puerto 9000
    _server = app.listen('9000', () => {
      //Si el entorno en el que estamos ejecutando es distinto de test
      if (process.env.NODE_ENV !== 'test') {
        //Que nos avise cuando este arrancando
        console.log('Server opened listen on http://localhost:9000')
      }
    })
  },
  //En close cerramos la instancia del servidor
  close () {
    _server.close()
  }
}

//Exportamos el objeto server
export default server

//Si se utiliza como modulo principal, que ejecute server.start()
if (!module.parent) {
  server.start()
}

3.- Ejecutamos npm run start y comprobamos que no hay errores

4.- Empezamos a configurar la API REST. Creamos dentro de src un fichero llamado config.js en el
que almacenaremos toda la informacion de nuestro servidor.

5.- Tendremos que instalar varios paquetes. Ejecutaremos en el terminal el siguiente comando:
npm install --save body-parser cors morgan

6.- Añadimos a config.js el siguiente codigo:
//Importamos body-parser
import bodyParser from 'body-parser'
//Importamos el logger morgan
import logger from 'morgan'
//Importamos cors
import cors from 'cors'

//Exportamos (la vamos a utilizar fuera) una funcion que por defecto recibirá la instancia del
//servidor creado
export default app => {
  //Desabilitamos el x-powered
  app.disable('x-powered-by')
 
  //Seteamos el entorno de desarrollo. Le decimos que nuestro entorno se define por
  //process.env.NODE_ENV
  app.set('env', process.env.NODE_ENV)

  //Desactivamos el logger en caso de los test
  if (process.env.NODE_ENV !== 'test') {
    //Usamos el formato de log combined que es el mas completo
    app.use(logger('combined'))
  }

  //Parsearenis todos los logs que nos lleguen a un formato visible
  app.use(bodyParser.json())
  app.use(bodyParser.urlencoded({ extended: false }))
 
  //Usamos cors. Cors permite configurar de forma automatica las cabeceras de la aplicacion
  app.use(cors())
}

7.- Añadimos en index.js el siguiente import en la parte de arriba a continuación del de express:
import config from './config'

Tambien debemos añadirla al server. Para ello, sustituiremos el
codigo de const server y todo su contenido por este:
const server = {
  start () {
    const app = express()
    //Recibimos el archivo de configuracion
    config(app)

    _server = app.listen('9000', () => {
      if (process.env.NODE_ENV !== 'test') {
        console.log('Server opened listen on http://localhost:9000')
      }
    })
  },
  close () {
    _server.close()
  }
}

8.- Ejecutamos npm run start para verificar que no hayan errores

9.- Ahora vamos a configurar el entorno de desarrollo o produccion. Para ello necesitaremos
la libreria dotenv que nos permitirá hacer muchas configuraciones. Para instalarla, ejecutar
en el terminal npm install --save dotenv

10.- Vamos a crear en la raiz del proyecto (en el nivel superior a src) un archivo llamado .env
en el que definiremos las variables de entorno. Introduciremos el siguiente codigo:
ENV=development
DEBUG=true
HOST=localhost
PORT=9000
TIMEZONE=Europe/Amsterdam

11.- Sustituir el codigo de config.js por este:
//Importamos body-parser
import bodyParser from 'body-parser'
//Importamos el logger morgan
import logger from 'morgan'
//Importamos cors
import cors from 'cors'
//Importamos solo la funcion config de la dependencia dotenv
import { config } from 'dotenv'

//Cargamos la configuracion en la constante settings. Esto guarda toda la informacion del
//fichero de configuracion
const SETTINGS = config()

//Exportamos (la vamos a utilizar fuera) una funcion que por defecto recibirá la instancia del
//servidor creado
export default app => {
  //Desabilitamos el x-powered
  app.disable('x-powered-by')
 
  //Seteamos el entorno de desarrollo. Le decimos que nuestro entorno se define por
  //process.env.NODE_ENV
  //app.set('env', process.env.NODE_ENV)
  //El entorno de desarrollo vendrá definido en la configuracion que esta almacenada en SETTINGS
  app.set('env', SETTINGS.parsed.ENV)
 
  //Seteamos la variable config y le decimos que guarde todos los datos de settings
  app.set('config', SETTINGS.parsed)
  //Le decimos que de forma local el entorno es env (variable seteada arriba)
  app.locals.env = app.get('env')
  //Seteamos el config en el config local
  app.locals.config = app.get('config')

  //Desactivamos el logger en caso de los test
  if (process.env.NODE_ENV !== 'test') {
    //Usamos el formato de log combined que es el mas completo
    app.use(logger('combined'))
  }

  //Parsearenis todos los logs que nos lleguen a un formato visible
  app.use(bodyParser.json())
  app.use(bodyParser.urlencoded({ extended: false }))
 
  //Usamos cors. Cors permite configurar de forma automatica las cabeceras de la aplicacion
  app.use(cors())
}

12.- Ejecutamos npm run start para verificar que no hay errores en el codigo

13.- Ahora añadiremos las rutas. Para ello, sobreescribiremos el objeto server (const server)
de index.js por este codigo:
const server = {
  start () {
    const app = express()

    config(app)

    // Rutas
    app.get('/', (req, res, next) => {
      res
         //Devolvermos el status 200 (todo ha ido bien y un objeto json)
        .status(200)
        .json({ data: 'metodo get' })
    })

    app.post('/', (req, res, next) => {
      res
         //Devolvermos el status 200 (todo ha ido bien y un objeto json)
        .status(200)
        .json({ data: 'metodo post' })
    })

    app.put('/', (req, res, next) => {
      res
         //Devolvermos el status 200 (todo ha ido bien y un objeto json)
        .status(200)
        .json({ data: 'metodo put' })
    })

    app.delete('/', (req, res, next) => {
      res
         //Devolvermos el status 200 (todo ha ido bien y un objeto json)
        .status(200)
        .json({ data: 'metodo delete' })
    })

    _server = app.listen(app.locals.config.PORT, () => {
      const address = _server.address()
      const host = address.address === '::'
        ? 'localhost'
        : address

      const port = app.locals.config.PORT
      if (process.env.NODE_ENV !== 'test') {
        console.log(`Server opened listen on http://${host}:${port}`)
      }
    })
  },
  close () {
    _server.close()
  }
}

14.- Ejecutamos npm run start para verificar que no hay errores